# üñ•Ô∏è –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤ 1000 —Å—Ç—Ä–æ–∫–∞—Ö –∫–æ–¥–∞ –Ω–∞ –°

> –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã RISC-V 32-bit, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø–æ –∫–Ω–∏–≥–µ [Operating System in 1,000 Lines](https://operating-system-in-1000-lines.vercel.app/en/)

![](./screenshot.png)

---

## üìã –°—Ç–µ–∫

- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** RISC-V 32-bit
- **–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä:** Clang —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π RISC-V
- **–Ø–∑—ã–∫:** C11 (freestanding)
- **–í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è:** QEMU (–¥–ª—è —ç–º—É–ª—è—Ü–∏–∏)

---

## üöÄ –û –ø—Ä–æ–µ–∫—Ç–µ

- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –±–∞–∑–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –∏ —Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏ (SV32)
  - –í—ã–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü –ø–∞–º—è—Ç–∏
  - –ú–∞–ø–ø–∏–Ω–≥ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ
  - –ò–∑–æ–ª—è—Ü–∏—è –∞–¥—Ä–µ—Å–Ω—ã—Ö –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- **–ú–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–æ 8 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
  - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
  - –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á —Å round-robin –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º
  - –ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ page tables
- **–°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã** –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º —Å —è–¥—Ä–æ–º
  - `SYS_PUTCHAR` ‚Äî –≤—ã–≤–æ–¥ —Å–∏–º–≤–æ–ª–∞ –≤ –∫–æ–Ω—Å–æ–ª—å
  - `SYS_GETCHAR` ‚Äî —á—Ç–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ (—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π)
  - `SYS_EXIT` ‚Äî –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
  - `SYS_READFILE` ‚Äî —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
  - `SYS_WRITEFILE` ‚Äî –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª
- **–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–æ—Ä–º–∞—Ç–∞ tar (ustar)
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–æ–≤
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏–∑ –æ–±—Ä–∞–∑–∞ –¥–∏—Å–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ –¥–∏—Å–∫ —á–µ—Ä–µ–∑ VirtIO
- **–†–∞–±–æ—Ç–∞ —Å –¥–∏—Å–∫–æ–º** —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å VirtIO Block Device
  - –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å —Å–µ–∫—Ç–æ—Ä–æ–≤ –¥–∏—Å–∫–∞
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π VirtIO
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π** —á–µ—Ä–µ–∑ trap handler
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ —á–µ—Ä–µ–∑ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é `ecall`
  - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ supervisor –∏ user
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞ (shell)** –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ
  - –ö–æ–º–∞–Ω–¥–∞ `hello` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
  - –ö–æ–º–∞–Ω–¥–∞ `exit` ‚Äî –≤—ã—Ö–æ–¥ –∏–∑ shell
  - –ö–æ–º–∞–Ω–¥–∞ `readfile` ‚Äî —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
  - –ö–æ–º–∞–Ω–¥–∞ `writefile` ‚Äî –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ kernel –∏ user space**
  - –Ø–¥—Ä–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ supervisor
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Ä–µ–∂–∏–º–µ user —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
  - –ó–∞—â–∏—Ç–∞ –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ page tables

---

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
OSIn1000Lines/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ kernel.c      # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ —è–¥—Ä–∞ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏, —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã)
‚îÇ   ‚îú‚îÄ‚îÄ kernel.h      # –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã —è–¥—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ kernel.ld     # –°–∫—Ä–∏–ø—Ç –ª–∏–Ω–∫–æ–≤–∫–∏ —è–¥—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ user.c        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ (—Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã)
‚îÇ   ‚îú‚îÄ‚îÄ user.h        # –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
‚îÇ   ‚îú‚îÄ‚îÄ user.ld       # –°–∫—Ä–∏–ø—Ç –ª–∏–Ω–∫–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º
‚îÇ   ‚îú‚îÄ‚îÄ shell.c       # –ö–æ–¥ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –æ–±–æ–ª–æ—á–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ common.c      # –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (printf, memset, memcpy, strcmp)
‚îÇ   ‚îú‚îÄ‚îÄ common.h      # –û–±—â–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ Makefile      # –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ disk/         # –§–∞–π–ª—ã –¥–ª—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hello.txt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ meow.txt
‚îÇ   ‚îî‚îÄ‚îÄ run.sh        # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –≤ QEMU –¥–ª—è Linux
‚îÇ   ‚îî‚îÄ‚îÄ run.bat        # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –≤ QEMU –¥–ª—è Windows
‚îî‚îÄ‚îÄ README.md         # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üéØ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Clang** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π RISC-V target
- **LLVM objcopy** (llvm-objcopy)
- **QEMU** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π RISC-V 32-bit

### –ó–∞–ø—É—Å–∫

```bash
cd src
./run.sh
```